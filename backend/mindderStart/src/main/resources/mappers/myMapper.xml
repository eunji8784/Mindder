<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.mindder.my.model.mapper.MyMapper">
	<resultMap type="FeedListDto" id="my">
		<result column="feed_idx" property="feedIdx" />
		<result column="comment_count" property="commentCount" />
		<result column="like_total_count" property="likeTotalCount" />
	</resultMap>
	<!-- 내가 쓴 피드 목록 조회 -->
	<!-- @fixme: 이미지 url 추가 필요 -->
	<select id="selectMyFeeds" parameterType="int" resultMap="my">
		select f.feed_idx, c.comment_count, l.like_total_count 
		from mainfeed f 
		left join (select feed_idx, count(*) as comment_count from feedcomment group by feed_idx) as c 
		on f.feed_idx = c.feed_idx 
		left join (select feed_idx, sum(like_count) as like_total_count from feedlike group by feed_idx) as l 
		on f.feed_idx = l.feed_idx 
		where user_idx = #{userIdx};
	</select>
</mapper>
