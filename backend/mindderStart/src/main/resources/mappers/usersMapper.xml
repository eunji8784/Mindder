<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.mindder.users.model.mapper.UsersMapper">
	<resultMap type="UsersDto" id="user">
		<result column="user_idx" property="userIdx" />
		<result column="email" property="email" />
		<result column="nickname" property="nickname" />
		<result column="password" property="password" />
		<result column="refresh_token" property="refreshToken" />
		<result column="is_deleted" property="isDeleted" />
		<result column="emote_color_idx" property="emoteColor" />
	</resultMap>
	<select id="login" parameterType="UsersDto" resultMap="user">
		select *
		from mainuser
		where email = #{email} and password = #{password}
	</select>
	<select id="searchUser" parameterType="String" resultMap="user">
		select *
		from mainuser
		where email = #{email}
	</select>
	<select id="checkUser" parameterType="int" resultMap="user">
		select *
		from mainuser
		where user_idx = #{userIdx}
	</select>
	<select id="findSocialID" parameterType="String" resultMap="user">
		select *
		from mainuser
		where social_id = #{id}
	</select>
	<select id="checkNickname" parameterType="String" resultType="int">
		select count(nickname)
		from mainuser
		where nickname =#{nickname}
	</select>
	<insert id="joinUser" parameterType="UsersDto">
		insert into mainuser(email,nickname,password,create_date,emote_color_idx)
		value(#{email},#{nickname},#{password},now(),#{emoteColor})
	</insert>
	<update id="addToken" parameterType="UsersDto">
		update mainuser
		set refresh_token = #{refreshToken}
		where user_idx = #{userIdx}
	</update>
	<update id="updateUser" parameterType="UsersDto" >
		update mainuser
		set nickname = #{nickname}, password = #{password}
		where user_idx = #{userIdx};
	</update>
	<update id="deleteUser" parameterType="int" >
		update mainuser
		set is_deleted = 1, update_date = now()
		where user_idx = #{userIdx};
	</update>
</mapper>
